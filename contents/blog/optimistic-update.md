---
title: Optimistic Update with react-query
tags: FE, react-query
category: post
---

# 글을 쓰게 된 계기

회사에서 어드민을 개발하다가 원인을 알 수 없는 버그를 발견했습니다.
데이터를 변경하는 API를 호출한 후 변경이 성공했다는 응답도 제대로 왔는데, 데이터를 다시 fetching한 결과는 과거 데이터와 동일했어요.
이게 너무 이상해서 포스트맨으로 다시 요청을 보내보니 거기에선 변경된 데이터가 정상적으로 응답되었습니다.
코드엔 이상한 점이 하나도 없는데, 정말로 하나도 없는데 왜 그럴까 고민하면서 코드를 지켜보고 있었는데 갑자기 이런 생각이 팍 떠올랐습니다.

> 데이터 변경이 서버에 반영되기까지 지연 시간이 있나보다!

개인 프로젝트나 동아리를 하게 되면 보통은 단일 서버로 구성했어서 원인을 바로 생각해내지 못했었어요.
단일 서버에서는 http 요청을 받은 후 DB에 적용하고 그 결과를 응답해주면 완벽히 완료가 되었기 때문에 이런 일을 겪을 수가 없었어요.

그런데 회사에선 정말 수많은 서버가 존재하고 유기적으로 연결되어 있겠죠. 그래서 내가 어떤 api에 요청을 보내서 응답을 제대로 받은 시점에서도 해당 변경 사항이 DB에 적용되기까지는 지연 시간이 충분히 있을 수 있었던 것입니다.


그런데 저의 상황은 사용자가 변경 액션을 취하면 실시간으로 변경사항이 적용되는 걸 꼭 보여주어야 했어요.
그래서 이 문제를 클라이언트에서는 어떻게 해결할 수 있을까 고민을 한 결과, 
Optimistic Update를 적용하게 되었습니다.

# Optimistic Update
먼저, Optimistic Update란 한국말로 '낙관적 업데이트'입니다.
말그대로 변경 사항을 "낙관적으로" 업데이트하는 것이에요. 즉, 변경 요청이 성공할 거라는 전제를 바탕으로 업데이트를 하는 것이죠.
그러다가 만약 요청이 실패하면 다시 그 업데이트를 화면에서 롤백하면 됩니다.

> 인스타그램의 피드 "좋아요"가 이런 방식을 취하고 있어요.
> 인터넷 연결을 끊은 후 인스타에서 피드에 좋아요를 눌러보세요. 몇 초 후에 하트가 다시 자동으로 사라지는 걸 볼 수 있습니다.

이 방식은 서버의 응답 지연에 관계없이 사용자에게 바로 액션에 대한 결과를 전달할 수 있는 장점이 있어요.

# React-Query로 적용해보기

