# JavaScript는 어떻게 동작할까?(Part1)
https://blog.bitsrc.io/how-does-javascript-really-work-part-1-7681dd54a36d

Part1 : JavaScript는 어떻게 동작할까?
Part2 : 

* * *

이 글을 읽으면 JavaScript 엔진에 대한 약간의 지식과 V8 엔진이 어떻게 동작하는지에 대한 지식을 얻을 수 있습니다.


JS 개발자 혹은 JS를 공부하는 학생이라면, 이 단어를 굉장히 많이 들어봤을 거에요. 바로,
>V8

두둥!



## 프로그래밍 언어가 어떻게 동작할까?
JavaScript를 살펴보기 전에, 프로그래밍 언어가 어떻게 동작하는지 살펴봅시다. 컴퓨터는 마이크로 프로세스로 구성되어 있어요. 그리고 우리는 이 작지만 강력한 컴퓨터를 통해 코드를 작성하죠. 하지만 마이크 로프로세서가 이해하는 언어는 뭘까요? 이 프로세서들은 자바나 파이썬 등(당연히 JavaScript도 포함이구요!) 모든 프로그래밍 언어를 하나도 이해하지 못합니다. 단지 "기계어"만 이해할 수 있어요.

## 컴파일러와 인터프리터
Interpreter:  코드를 한 줄, 한 줄 읽고 번역해요. JavaScript의 경우, 처음에는 인터프리터처럼 동작해요.
Compiler : 컴파일러는 우리가 작성한 코드를 기계어로 변환해서 새로운 파일로 만들어요.

그리고 컴파일러/인터프리터는 자기들이 처리하는 것과 같은 언어 혹은 다른 어떠한 언어로도 작성될 수 있어요.

JavaScript를 기계어로 번역하는 방법에는 2가지가 있어요.
1. 코드를 compile(기계어로 변환)하면, 
    코드가 실행되기 전에 어떤 일이 일어날지 더 잘 이해하게 되어서 프로그램의 실행이 더 빨라지지만, 이 프로세스를 시작하기 전에 변환하는 시간이 소모돼요.
2. 반대로 코드를 interpret(해석)하게 되면,
	프로그램이 실행과 동시에 바로 시작되지만, 최적화 기능이 부족하면 대규모 어플리케이션에서는 속도가 많이 느려져요.

세상엔 똑똑한 사람이 정말 많죠.. 그래서 ECMAScript 엔진을 만든 사람들은 앞서 언급한 두 가지 장점을 모두 사용하고 있어요. JIT(Just-in-time) 컴파일러를 만들었죠. JavaScript는 컴파일(compile)되고 해석(interpret)되지만 실제 구현과 순서는 엔진에 따라 달라요. 

그럼 구글이 V8 엔진에 채택한 전략이 무엇인지 알아볼까요?


## JavaScript를 기계어로
JavaScript의 경우에는 JS엔진이 기계어로 변환해줘요. 다른 언어들처럼 이 엔진은 어떠한 언어로도 만들어질 수 있어요. 그래서 엔진이 딱 하나만 존재하는 건 아니에요.

* V8은 크롬 브라우저를 위한 엔진의 구현체에요. 구글이 만들었죠!
* SpiderMonkey는 Netscape Navigator를 위해 만들어진 첫 번째 엔진이에요. 지금은 FireFox의 엔진이 되었어요.
* JavaScriptCore는 애플이 Safari 브라우저에 사용하는 거에요.

JS엔진은 이거보다 훨씬 많아요.. 혹시 Internet Exploere 이전의 엔진이 궁금하다면 [위키피디아](https://en.wikipedia.org/wiki/JavaScript_engine)를 살펴보세요!

## ECMAScript
(한국말로는 이크마스크립트 혹은 에크마스크립트라고 읽어요.)

이 방대한 엔진의 리스트를 보다보면 어떤 궁금증이 생기지 않나요?!
>그럼 나도 나만의 엔진을 만들 수 있는건가?

맞아요! 만들 수 있어요! ECMAScript 표준을 따른다면요.

translator(번역기)를 만들려면 기계어와 JavaScript 사이에 유효한 단어를 알아야 해요. 그리고 우리는 기계어로 어떤 것이 유효한지 이미 알고 있어요. 하지만 JavaScript에서 어떤 것이 유효한지는 표준화되어야 하죠.

이 JavaScript의 표준은 Ecma International in specification 이라고 불리는 기관에서 만들어요.

그럼 이제
>What's new in ES7?

이라는 제목의 아티클을 보면 뭔지 알 수 있겠죠?
그 아티클은 ECMAScript 표준에 의해서 새롭게 추가된 JavaScript의 기능을 이야기할 거에요.


## V8 엔진

### 약간의 history
구글은 브라우저에서 동작하는, 아주 많은 연산(processing power)이 필요한 Google Maps를 만들었어요. 그 때까지만 해도 JavaScript 구현체는 지도를 빠르게 계산할 만큼 썩 좋지 않았어요. 하지만 구글은 더 많은 돈을 벌기 위해서 이 서비스를 많은 사용자들에게 제공을 하고 싶었어요. 그러기 위해선 이 서비스가 더 빠르고 강력해야 했어요.
결국 구글은 V8이라고 불리는 엔진을 C++를 만들어서 2008년에 런칭했습니다.

### tree를 파싱하고 빌드하기
JavaScript 파일은 엔진에 들어가고, 파서(parser)는 어휘(lexical) 분석을 합니다. 이 lexical 분석은 코드를 토큰으로 구분해서 의미를 식별하는 과정이에요. 그리고 이 토큰들은 AST(Abstract Syntax Tree)를 구성하게 됩니다. 이 과정을 통해서 컴파일러가 언어 요소와 키워드의 올바른 사용을 검증하게 돼요.

AST는 lexical 분석에서 중요한 역할을 합니다. 나중에 AST는 실제 바이트 코드 또는 기계 코드를 생성하는 데 사용되거든요!


### 엔진의 심장
* JavaScript는 Ignition이라는 이름의 인터프리터에 의해 해석돼요. 그리고 TurboFan이라는 이름의 JIT 최적화 컴파일러에 의해 컴파일됩니다.
* 처음에는 이전 단계에서 생성된 AST가 인터프리터에 제공됩니다. 그래서 최적화되지 않은 기계 코드를 빠르게 생성하고 지연 없이 실행을 시작할 수 있어요.  
* Profiler는 코드가 실행되는 동안 이를 감시하고 최적화를 수행할 수 있는 영역을 식별합니다. 예를 들어, 'for' 루프가 100번 실행되지만 각 반복에서 동일한 결과를 생성합니다.  
* 이 프로파일러를 사용하면 최적화되지 않은 코드가 컴파일러로 전달되어 최적화를 수행하고 기계 코드를 생성하며, 이는 결국 인터프리터에 의해 이전에 생성된 최적화되지 않은 코드의 해당 코드를 대체합니다.  
* 프로파일러와 컴파일러가 바이트 코드를 지속적으로 변경함에 따라 JavaScript 실행 성능이 점차 향상됩니다.


### history 한 스푼 더...
V8 버전 5.9가 출시되기 전에는 두 개의 최적화 컴파일러와 기준 컴파일러를 사용했습니다.  
  
전체 코드젠이라는 이름의 베이스라인 컴파일러가 최적화되지 않은 컴퓨터 코드를 빠르게 생성했습니다.  
코드 최적화에는 크랭크샤프트와 터보팬이라는 두 개의 최적화 컴파일러가 사용되었습니다.  
JavaScript에 새로운 기능이 추가됨에 따라 V8 팀은 아키텍처 복잡성이 증가함에 따라 동일한 파이프라인을 유지하기가 어려워졌습니다. 이전 접근 방식과 새 파이프라인으로 전환한 이유에 대해 자세히 알아보려면 여기를 참조하십시오.


### 미래에는?
이러한 V8 엔진의 작동 방식은 향후 성능을 더욱 향상시키기 위한 연구가 더 진행됨에 따라 달라질 수 있습니다. 또한 웹 어셈블리가 모양을 갖추기 시작하면 파이프라인에 추가 단계가 추가될 수 있습니다.


## 결론
ECMA스크립트 엔진에는 많은 구현이 있으며 구글의 V8이 가장 유명합니다. 저는 이 기사가 자바스크립트가 어떻게 작동하는지뿐만 아니라 프로그래밍 언어가 어떻게 작동하는지 간략하게 설명하는 데 성공하기를 바랍니다. V8 팀의 향후 계획을 알고 싶거나 엔진에 대한 자세한 내용을 알고 싶다면, 여기에 멋진 블로그가 있습니다.  
  
이 기사의 2부는 메모리 힙, 스택, 이벤트 루프와 자바스크립트 코드 실행과 관련된 더 많은 개념에 대해 말하는 것입니다. 채널 고정해 주세요.

